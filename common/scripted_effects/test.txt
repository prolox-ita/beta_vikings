state_migration = {
	every_state = {
		clear_array = local_culture_array
		clear_array = local_culture_perc_array
		clear_array = local_culture_pop_array
		
		every_neighbor_state = {
			
			for_each_loop = {
				array = state_culture_ordered_array
				
				if = {
					limit = {
						is_in_array = {
							array = PREV.local_culture_array
							value = state_culture_ordered_array^v
						}
					}
					set_temp_variable = { local_length_temp = state_culture_ordered_array^num }
					for_loop_effect = {
						start = 0
						end = length_temp
						add = 1
						value = v 
						break = b						

						if = {
							limit = {
								check_variable = {
									var = PREV.local_culture_array
									index = j
									value = state_culture_ordered_array^v
								}
							}
						}
						#set_temp_variable = { a_temp = PREV.local_culture_array^j } 
						set_temp_variable = { state_culture_ordered_array_num_temp = state_culture_ordered_array_num^i } 
						set_temp_variable = { state_culture_ordered_pop_array_temp = state_culture_ordered_pop_array^i } 
						set_temp_variable = { state_id_array_temp = state_id_array^i } 
						add_to_variable = {
							PREV.local_culture_perc_array^j = state_culture_ordered_array_num_temp
						}
						add_to_variable = {
							PREV.local_culture_pop_array^j = state_culture_ordered_pop_array_temp
						}
						add_to_variable = {
							PREV.local_state_id_array^j = state_id_array_temp
						}
					}
				}
				else = {
					set_temp_variable = { state_culture_ordered_array_num_temp = state_culture_ordered_array_num^i } 
					set_temp_variable = { state_culture_ordered_pop_array_temp = state_culture_ordered_pop_array^i } 
					set_temp_variable = { state_culture_ordered_array_temp = state_culture_ordered_array^i }
					set_temp_variable = { state_id_array_temp = state_id_array^i } 

					add_to_array = { 
						array = PREV.local_culture_array 
						value = state_culture_ordered_array_temp 
					}
					add_to_array = {
						array = PREV.local_culture_perc_array 
						value = state_culture_ordered_array_num_temp 
					}
					add_to_array = {
						array = PREV.local_culture_pop_array 
						value = state_culture_ordered_pop_array_temp 
					}
					add_to_array = {
						array = PREV.local_state_id_array 
						value = state_id_array_temp 
					}
				}
				
			}
		}
	}
}